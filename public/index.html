<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Party Prompts & Responses</title>
    <style>
      :root {
        --orange: #ff7518;
        --black: #000;
        --card-bg: rgba(25, 25, 25, 0.9);
        --muted: #f5b97a;
        --text: #fff5e1;
        --highlight: #ffb347;
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; margin: 0; padding: 0; }

      /* === HALLOWEEN BAT BACKGROUND === */
      body {
        background: var(--orange);
        background-image: radial-gradient(rgba(0,0,0,0.35) 1px, transparent 1px),
                          url("https://i.imgur.com/xZxfl7C.png");
        background-size: 20px 20px, 200px auto;
        background-repeat: repeat, repeat;
        color: var(--text);
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        display: flex;
        align-items: stretch;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      /* Add faint bats overlay if image fails */
      body::after {
        content: "ðŸ¦‡ ðŸ¦‡ ðŸ¦‡";
        position: fixed;
        bottom: 10px;
        right: 20px;
        font-size: 2rem;
        opacity: 0.1;
        pointer-events: none;
      }

      .wrap {
        width: 100%;
        max-width: 940px;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .title {
        font-weight: 700;
        font-size: 1.4rem;
        color: var(--text);
        text-shadow: 0 0 8px rgba(0,0,0,0.8);
      }

      .meta {
        font-size: 0.9rem;
        color: var(--muted);
      }

      .list {
        background: var(--card-bg);
        border-radius: 16px;
        backdrop-filter: blur(10px);
        box-shadow: 0 10px 40px rgba(0,0,0,.6);
        padding: 12px;
        height: calc(100vh - 120px);
        overflow: auto;
      }

      .item {
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 12px;
        padding: 14px 16px;
        background: var(--card-bg);
        margin: 10px 6px;
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .item.featured {
        outline: 2px solid var(--highlight);
        box-shadow: 0 0 15px rgba(255, 180, 71, 0.8), 0 12px 40px rgba(0,0,0,0.7);
        transform: scale(1.05);
      }

      .label { font-size: 0.85rem; color: var(--muted); }
      .prompt { font-weight: 700; font-size: 1.1rem; white-space: pre-wrap; word-break: break-word; color: #fffbe6; }
      .response { font-size: 1.2rem; line-height: 1.5; white-space: pre-wrap; word-break: break-word; color: #ffeac1; }
      .tone, .time { font-size: 0.8rem; color: var(--muted); margin-top: 6px; }
      .divider { height: 1px; border: none; background: #444; margin: 8px 0; }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="header">
        <div class="title">ðŸŽƒ Party Prompts & Responses ðŸ¦‡</div>
        <div class="meta" id="status">Loadingâ€¦</div>
      </div>
      <div class="list" id="list"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
      const CSV_URL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ42XwxVWPk57rtdQ963L3eWS2rh-rGQmbiLWEHdLTlAfcmGY2IelxfW8wX5Ux2ZQbZ0Al5zYXvzBiE/pub?gid=921597158&single=true&output=csv";

      let featuredIndex = 0;
      let lastFingerprint = null;

      const PROMPT_NAMES   = ["Prompt","Your Prompt","Question","Input"];
      const RESPONSE_NAMES = ["Response","Answer","Output","AI Response","ChatGPT Response","OpenAI Response"];
      const TONE_NAMES     = ["Tone","Style"];
      const TIME_NAMES     = ["Timestamp","Time","Submitted At","Created","Created At","Date"];

      function findKey(obj, names) {
        const keys = Object.keys(obj);
        for (const name of names) {
          const match = keys.find(k => k.toLowerCase().trim() === name.toLowerCase().trim());
          if (match) return match;
        }
        return null;
      }

      function safe(v) { return v ? String(v).replace(/\r\n|\r|\n/g, "\n") : ""; }
      function fmtTime(v) {
        if (!v) return "";
        const d = new Date(v);
        return isNaN(d) ? String(v) : d.toLocaleString();
      }

      function makeItem({prompt, response, tone, time}) {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div class="label">Prompt</div>
          <div class="prompt">${safe(prompt)}</div>
          <hr class="divider" />
          <div class="label">Response</div>
          <div class="response">${safe(response)}</div>
          ${tone ? `<div class="tone">Tone: ${safe(tone)}</div>` : ""}
          ${time ? `<div class="time">${safe(time)}</div>` : ""}
        `;
        return div;
      }

      function applyFeatured() {
        const items = document.querySelectorAll(".item");
        if (!items.length) return;
        if (featuredIndex >= items.length) featuredIndex = 0;
        items.forEach((el, i) => el.classList.toggle("featured", i === featuredIndex));
      }

      function fingerprint(rows) {
        const newest = rows[0] || {};
        return JSON.stringify([rows.length, newest["Prompt"], newest["Response"]]);
      }

      async function refresh() {
        const status = document.getElementById("status");
        const listEl = document.getElementById("list");

        try {
          const res = await fetch(CSV_URL, { cache: "no-store" });
          const text = await res.text();
          const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });
          const rows = parsed.data || [];
          if (!rows.length) {
            listEl.innerHTML = "<div class='item'>No entries yet</div>";
            status.textContent = "Updated: â€”";
            return;
          }

          rows.reverse();
          const fp = fingerprint(rows);
          if (fp !== lastFingerprint) {
            lastFingerprint = fp;
            listEl.innerHTML = "";
            rows.forEach(r => {
              const pKey = findKey(r, PROMPT_NAMES);
              const rKey = findKey(r, RESPONSE_NAMES);
              const tKey = findKey(r, TONE_NAMES);
              const timeK = findKey(r, TIME_NAMES);
              const prompt = pKey ? r[pKey] : "";
              const response = rKey ? r[rKey] : "";
              const tone = tKey ? r[tKey] : "";
              const time = timeK ? r[timeK] : "";
              if (!(String(prompt).trim() || String(response).trim())) return;
              listEl.appendChild(makeItem({ prompt, response, tone, time: fmtTime(time) }));
            });
            featuredIndex = 0;
            applyFeatured();
          } else applyFeatured();

          status.textContent = "Updated: " + new Date().toLocaleTimeString();
        } catch (e) {
          console.error(e);
          status.textContent = "Error fetching sheet";
        }
      }

      refresh();
      setInterval(refresh, 15000);
      setInterval(() => {
        const items = document.querySelectorAll(".item");
        if (!items.length) return;
        featuredIndex = (featuredIndex + 1) % items.length;
        applyFeatured();
        items[featuredIndex].scrollIntoView({ behavior: "smooth", block: "center" });
      }, 20000);
    </script>
  </body>
</html>
