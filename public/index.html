<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Party Prompts & Responses</title>
    <style>
      :root {
        --orange: #ff8613;
        --dark: #1a1a1a;
        --card-bg: rgba(20, 20, 20, 0.85);
        --text-light: #f5f5f5;
        --muted: #d3d3d3;
        --highlight: #ffb347;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; margin: 0; padding: 0; }

      body {
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
        color: var(--text-light);
        display: flex;
        align-items: stretch;
        justify-content: center;
        position: relative;
        overflow: hidden;
        background: linear-gradient(to bottom, var(--orange) 0%, var(--dark) 70%);
      }

      /* Haunted-house + bats via SVG overlay */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: url("data:image/svg+xml;base64, \
          PHN2ZyB3aWR0aD0iMTIwMCIgaGVpZ2h0PSI3MjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ \
          PHBhdGggZD0iTTAsNzIwIEg1MDBMMTAsNDgwaC0xMEwwLDcyMEwiIGZpbGw9IiMwMDAiIC8+ \
          PHBhdGggZD0iTTQwMCw3MjAgSDcwMEwgNTUwLDM1MEg0MDBMNDAsNzIwIiBmaWxsPSIjMDAwIiAv+ \
          PHBhdGggZD0iTTc0MCw3MjAgSDk0MEwgODA3LDMxMEg3NDBMODAsNzIwIiBmaWxsPSIjMDAwIiAv+ \
          PHBhdGggZD0iTTIwMCwxNTAgQzIwMCwxMjAgMjYwLDEyMCAzMDAsMTUwIEMzNDAsMTgwIDI2MCwyMDAgMjAwLDE1MCIgZmlsbD0iIzAwMCIgLz4 \
          PHBhdGggZD0iTTEwMCw1NzAgQzEwMCw1MjAgMTQwLDUyMCAxNzAsNTcwIiBmaWxsPSIjMDAwIiAv+ \
          PHBhdGggZD0iTTUwMCw0MDBDNTAwLDM1MCA1NTAzMCAzNTAgNjAwLDQwMCIgZmlsbD0iIzAwMCIgLz4 \
          PC9zdmc+") no-repeat center bottom;
        background-size: cover;
        opacity: 0.4;
        pointer-events: none;
        z-index: 0;
      }

      .wrap {
        width: 100%;
        max-width: 900px;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        z-index: 1;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .title {
        font-size: 1.4rem;
        font-weight: bold;
        text-shadow: 1px 1px 4px rgba(0,0,0,0.7);
      }

      .meta {
        font-size: 0.9rem;
        color: var(--muted);
      }

      .list {
        background: var(--card-bg);
        border-radius: 16px;
        backdrop-filter: blur(8px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.6);
        padding: 12px;
        height: calc(100vh - 120px);
        overflow: auto;
      }

      .item {
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 12px;
        padding: 14px 16px;
        margin: 10px 6px;
        background: var(--card-bg);
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .item.featured {
        outline: 2px solid var(--highlight);
        box-shadow: 0 0 15px rgba(255, 180, 71, 0.8), 0 12px 40px rgba(0,0,0,0.7);
        transform: scale(1.05);
      }

      .item.featured .prompt { font-size: 1.3rem; }
      .item.featured .response { font-size: 1.5rem; }

      .label {
        font-size: 0.85rem;
        color: var(--muted);
      }

      .prompt {
        font-weight: 700;
        white-space: pre-wrap;
        word-break: break-word;
      }

      .response {
        font-size: 1.05rem;
        line-height: 1.4;
        white-space: pre-wrap;
        word-break: break-word;
      }

      .tone, .time {
        font-size: 0.8rem;
        color: var(--muted);
        margin-top: 6px;
      }

      .divider {
        height: 1px;
        border: none;
        background: #333;
        margin: 8px 0;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="header">
        <div class="title">Party Prompts & Responses</div>
        <div class="meta" id="status">Loading…</div>
      </div>
      <div class="list" id="list"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
      const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ42XwxVWPk57rtdQ963L3eWS2rh-rGQmbiLWEHdLTlAfcmGY2IelxfW8wX5Ux2ZQbZ0Al5zYXvzBiE/pub?gid=921597158&single=true&output=csv";

      let featuredIndex = 0;
      let lastFingerprint = null;

      const PROMPT_NAMES   = ["Prompt","Your Prompt","Question","Input"];
      const RESPONSE_NAMES = ["Response","Answer","Output","AI Response","ChatGPT Response","OpenAI Response"];
      const TONE_NAMES     = ["Tone","Style"];
      const TIME_NAMES     = ["Timestamp","Time","Submitted At","Created","Created At","Date"];

      function findKey(obj, names) {
        const keys = Object.keys(obj);
        for (const name of names) {
          const match = keys.find(k => k.toLowerCase().trim() === name.toLowerCase().trim());
          if (match) return match;
        }
        return null;
      }
      function safe(v) { return v ? String(v).replace(/\r\n|\r|\n/g, "\n") : ""; }
      function fmtTime(v) {
        if (!v) return "";
        const d = new Date(v);
        return isNaN(d) ? String(v) : d.toLocaleString();
      }
      function isNameIn(k, arr) { return arr.some(n => n.toLowerCase().trim() === String(k).toLowerCase().trim()); }

      function makeItem({prompt, response, tone, time}) {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div class="label">Prompt</div>
          <div class="prompt">${safe(prompt)}</div>
          <hr class="divider" />
          <div class="label">Response</div>
          <div class="response">${safe(response)}</div>
          ${tone ? `<div class="tone">Tone: ${safe(tone)}</div>` : ""}
          ${time ? `<div class="time">${safe(time)}</div>` : ""}
        `;
        return div;
      }

      function applyFeatured() {
        const items = document.querySelectorAll(".item");
        if (!items.length) return;
        if (featuredIndex >= items.length) featuredIndex = 0;
        items.forEach((el, i) => el.classList.toggle("featured", i === featuredIndex));
      }

      function fingerprint(rows) {
        const newest = rows[0] || {};
        return JSON.stringify([rows.length, newest["Prompt"], newest["Response"]]);
      }

      async function refresh() {
        const status = document.getElementById("status");
        const listEl = document.getElementById("list");

        try {
          const res = await fetch(CSV_URL, { cache: "no-store" });
          const text = await res.text();
          const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });
          const rows = parsed.data || [];
          if (!rows.length) {
            listEl.innerHTML = "<div class='item'>No entries yet</div>";
            status.textContent = "Updated: —";
            return;
          }

          rows.reverse();
          const fp = fingerprint(rows);
          if (fp !== lastFingerprint) {
            lastFingerprint = fp;
            listEl.innerHTML = "";
            const fields = parsed.meta?.fields

